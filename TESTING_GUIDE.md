# 账号切换功能测试指南

## 测试目标
验证账号切换功能是否完全正确，包括地图、资源、建筑等所有状态的切换。

---

## 测试步骤

### 准备工作
1. 启动游戏，创建至少 2 个账号
2. 每个账号应该有不同的状态：
   - 不同的地图（系统会随机分配）
   - 不同的资源数量
   - 不同的建筑布局

### 测试用例 1: 基本切换
1. 登录账号 A
2. 记录以下信息：
   - 当前地图（Map1/Map2/Map3）
   - 金币数量
   - 圣水数量
   - 宝石数量
   - 建筑数量和位置
3. 打开设置面板 → 点击"切换账号"
4. 选择账号 B
5. **验证以下内容是否正确**：
   - ? 地图切换到账号 B 的专属地图
   - ? HUD 显示账号 B 的资源数量
   - ? 显示账号 B 的建筑布局
   - ? 没有账号 A 的残留建筑
   - ? 场景流畅切换，没有卡顿或闪烁

### 测试用例 2: 状态保存
1. 登录账号 A
2. 放置一个新建筑（例如：炮塔）
3. 记住建筑的位置
4. 切换到账号 B
5. 在账号 B 中放置不同的建筑
6. 切换回账号 A
7. **验证**：
   - ? 之前放置的炮塔还在原来的位置
   - ? 没有账号 B 的建筑出现在账号 A 中

### 测试用例 3: 资源独立性
1. 登录账号 A
2. 使用测试功能："资源全满"
3. 记录资源数量（应该是 100,000 金币和圣水）
4. 切换到账号 B
5. **验证**：
   - ? 账号 B 的资源是它自己的数量，不是 100,000
6. 切换回账号 A
7. **验证**：
   - ? 账号 A 的资源仍然是 100,000

### 测试用例 4: 地图分配
1. 创建 10 个新账号
2. 记录每个账号分配的地图
3. **验证**：
   - ? 地图分配是随机的（大约各占 1/3）
   - ? 每个账号的地图在切换后保持不变

### 测试用例 5: 多次快速切换
1. 在 3 个账号之间快速切换 10 次
2. **验证**：
   - ? 每次切换都正确显示对应账号的数据
   - ? 没有崩溃或错误
   - ? 没有内存泄漏（可以通过任务管理器观察内存使用）

---

## 预期结果

所有测试用例都应该通过 ?

### 成功标志
- 切换账号后，HUD 立即显示新账号的资源
- 切换账号后，地图自动切换到新账号的专属地图
- 切换账号后，建筑布局完全是新账号的布局
- 没有任何旧账号的残留数据或显示

### 失败标志（如果出现，需要修复）
- ? HUD 显示的还是旧账号的资源
- ? 地图没有切换
- ? 建筑布局错乱或混合了两个账号的建筑
- ? 切换时崩溃或出现错误日志
- ? 切换后某些 UI 没有更新

---

## 调试技巧

### 查看日志
切换账号时应该看到以下日志（按顺序）：
```
? Preparing to switch to account: [账号名]
? Switching to account: [账号名]
? Account switch initiated...
? Saved current account state
? Switched to account: [账号ID]
? Account switched successfully, reloading scene...
? Loading assigned map for account [账号名]: [地图路径]
? Game state loaded
```

### 如果出现问题
1. 检查日志，看看是哪一步出错
2. 确认 `AccountManager` 是否正确保存/加载了游戏数据
3. 确认 `BuildingManager` 是否正确保存/加载了建筑
4. 确认 `ResourceManager` 是否正确同步了资源

---

## 性能测试

### 内存使用
- 切换前记录内存使用
- 切换 10 次后再记录
- **验证**：内存使用不应该持续增长（允许轻微波动）

### 切换速度
- 切换过程应该在 0.5 秒内完成
- 过渡动画流畅（0.3 秒淡入淡出）

---

## 已知限制

1. **第一次创建账号时的地图分配**：如果是旧账号（升级前创建的），会默认使用 Map1.png
2. **切换过程中的网络请求**：目前还没有实现服务器同步，所有数据都存储在本地

---

## 测试完成后

如果所有测试都通过，可以：
1. 在 Git 中提交这次更改
2. 更新版本号
3. 准备发布测试版本

如果发现问题，请记录：
- 具体的测试用例编号
- 出现的现象
- 日志输出
- 复现步骤
