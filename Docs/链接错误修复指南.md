# 链接错误修复指南

## 问题
编译时出现以下链接错误：
```
LNK2019: 无法解析的外部符号 SettingsPanel::init
LNK2019: 无法解析的外部符号 SettingsPanel::show
LNK2019: 无法解析的外部符号 DraggableMapScene::onAccountSwitched
```

## 解决方案

### 方法1：在 Visual Studio 中手动添加文件（推荐）

1. **打开 Visual Studio**
   - 打开项目 `HelloCpp.vcxproj`

2. **添加 SettingsPanel.cpp**
   - 在解决方案资源管理器中，找到 `HelloCpp` 项目
   - 右键点击 "源文件" 筛选器
   - 选择 "添加" → "现有项"
   - 浏览到 `C:\Users\Shalom\Documents\GitHub\coc\Classes\UI\SettingsPanel.cpp`
   - 点击"添加"

3. **添加 SettingsPanel.h**（可选）
   - 右键点击 "头文件" 筛选器
   - 选择 "添加" → "现有项"
   - 浏览到 `C:\Users\Shalom\Documents\GitHub\coc\Classes\UI\SettingsPanel.h`
   - 点击"添加"

4. **重新编译**
   - 按 Ctrl+Shift+B 或选择 "生成" → "生成解决方案"

### 方法2：直接编辑 HelloCpp.vcxproj.filters

1. **关闭 Visual Studio**

2. **编辑 HelloCpp.vcxproj.filters**
   - 找到文件：`proj.win32\HelloCpp.vcxproj.filters`
   - 用文本编辑器打开

3. **在 `<ItemGroup>` 中添加**：

```xml
<!-- 在 ClCompile 部分添加 -->
<ClCompile Include="..\Classes\UI\SettingsPanel.cpp">
  <Filter>src\UI</Filter>
</ClCompile>

<!-- 在 ClInclude 部分添加 -->
<ClInclude Include="..\Classes\UI\SettingsPanel.h">
  <Filter>src\UI</Filter>
</ClInclude>
```

4. **如果没有 UI Filter，先添加 Filter**：

```xml
<Filter Include="src\UI">
  <UniqueIdentifier>{6cc72b02-7089-4adc-8002-0f4e47c30000}</UniqueIdentifier>
</Filter>
```

5. **保存文件并重新打开 Visual Studio**

### 方法3：清理并完全重新生成

```powershell
# 在 proj.win32 目录下执行
cd C:\Users\Shalom\Documents\GitHub\coc\proj.win32
Remove-Item CMakeCache.txt
Remove-Item -Recurse -Force CMakeFiles
cd ..
cmake -S . -B proj.win32
```

## 验证修复

编译成功后应该看到：
```
========== 生成: 成功 1 个 ==========
```

## 额外检查

### 确认文件存在
```powershell
Test-Path "C:\Users\Shalom\Documents\GitHub\coc\Classes\UI\SettingsPanel.cpp"
Test-Path "C:\Users\Shalom\Documents\GitHub\coc\Classes\UI\SettingsPanel.h"
```

两个命令都应该返回 `True`

### 确认 onAccountSwitched 已添加
在 `DraggableMapScene.cpp` 文件末尾应该有：
```cpp
void DraggableMapScene::onAccountSwitched()
{
    if (_buildingManager)
    {
        _buildingManager->saveCurrentState();
    }
    
    if (_buildingManager)
    {
        _buildingManager->loadCurrentAccountState();
        CCLOG("? Account switched, game state reloaded");
    }
}
```

## 如果仍然失败

尝试完全清理项目：
1. 关闭 Visual Studio
2. 删除 `proj.win32\Debug` 目录
3. 删除 `proj.win32\*.vcxproj.user` 文件
4. 重新打开 Visual Studio
5. 清理解决方案：生成 → 清理解决方案
6. 重新生成：生成 → 重新生成解决方案
